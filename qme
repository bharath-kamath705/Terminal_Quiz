#!/bin/bash

#set directory for qme program and files
QME="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

#total number of question in the question bank
NUM_LINES="$(cat $QME/qme_questions.txt | wc -l)"

case "$1" in

	-c)
	#number of random questions seen this session
	#----------------------------------------
	cat $QME/qme_session.log | wc -l
	;;

	-t)
	#number of random questions in total
	#----------------------------------------
	cat $QME/qme_alltime.log | wc -l
	;;	

	-q|--question)
	#Show Nth question  
	#----------------------------------------
	sed "$2q;d" $QME/qme_questions.txt
	;;

	-a|--answer)
	#Show Nth answer  
	#----------------------------------------
	sed "$2q;d" $QME/qme_answers.txt
	;;

	-e)
	#Edit Nth question  
	#----------------------------------------
	cat $QME/qme_questions.txt | cut --fields 2 | sed "$2 c$3"| cat -n >$QME/qtmp.txt
	rm $QME/qme_questions.txt
	mv $QME/qtmp.txt $QME/qme_questions.txt	
	;;

	-f)
	#Edit Nth answer  
	#----------------------------------------
	cat $QME/qme_answers.txt | cut --fields 2 | sed "$2 c$3"| cat -n >$QME/atmp.txt
	rm $QME/qme_answers.txt
	mv $QME/atmp.txt $QME/qme_answers.txt	
	;;

	--add)
	#add question and answer to the database  
	#----------------------------------------
	echo $2 | cat -n >>$QME/qme_questions.txt
	echo $3 | cat -n >>$QME/qme_answers.txt
	cut $QME/qme_questions.txt --fields 2 | cat -n | tee $QME/qme_questions.txt >/dev/null
	cut $QME/qme_answers.txt --fields 2 | cat -n | tee $QME/qme_answers.txt >/dev/null
	;;

	--remove)
	#remove Nth question and answer
	#----------------------------------------	
	let top=$2-1
	let bot=$NUM_LINES-$2	
	
	#remove question and write to qtmp.txt
	head $QME/qme_questions.txt -n $top >$QME/qtmp.txt
	tail $QME/qme_questions.txt -n $bot >>$QME/qtmp.txt

	#remove answer and write to atmp.txt
	head $QME/qme_answers.txt -n $top >$QME/atmp.txt
	tail $QME/qme_answers.txt -n $bot >>$QME/atmp.txt

	#re-number lines and remove qtmp.txt and atmp.txt
	cut $QME/qtmp.txt --fields 2 | cat -n | tee $QME/qme_questions.txt >/dev/null
	cut $QME/atmp.txt --fields 2 | cat -n | tee $QME/qme_answers.txt >/dev/null	
	rm $QME/qtmp.txt $QME/atmp.txt	
	;;

	--clear-log)
	#reset the all time log
	#----------------------------------------
	rm $QME/qme_alltime.log
	;;

	--reset)
	#reset questions and answers to default
	#----------------------------------------
	cp $QME/qme_questions_default.txt $QME/qme_questions.txt
	cp $QME/qme_answers_default.txt $QME/qme_answers.txt
	;;	 


	*)
	#show random question     	
	#----------------------------------------
        cat $QME/qme_questions.txt | head -n $(shuf -i 1-${NUM_LINES} -n 1) | tail -n 1
	
	#logs to keep track of number of random questions shown
	date >> $QME/qme_session.log  # erased every session
	date >> $QME/qme_alltime.log  

esac

